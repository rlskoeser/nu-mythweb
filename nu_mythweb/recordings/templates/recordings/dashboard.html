{% extends "base.html" %}
{% load humanize %}

{% block content %}
<h2>Current Status</h2>

{% if error %}
     <p class="error">‚ö†Ô∏è {{ error }}</p>
{% endif %}


<div class="grid">

    <aside>
        <article>
            <header>‚è∞ Upcoming Recordings</header>
            {% for prog in upcoming %}
                <div style="margin-bottom: 1rem; border-bottom: 1px solid var(--pico-muted-border-color); padding-bottom: 0.5rem;">
                    <strong>{{ prog.Title }}</strong> <br/>
                    <small>{{ prog.SubTitle|default:"" }}<br/>
                     {{ prog.dt_start|naturalday }} {{ prog.dt_start|date:"g:i A" }}<br/>
                    {{ prog.dt_start|naturaltime }}</small>
                </div>
            {% empty %}
                <p>No upcoming recordings.</p>
            {% endfor %}
            <footer><a href="{% url 'upcoming' %}" class="secondary">View all ‚Üí</a></footer>
        </article>
    </aside>

    <aside>
        <article>
            <header>üé• Last 3 Recordings</header>
            {% for prog in recorded %}
                <div style="margin-bottom: 1rem; border-bottom: 1px solid var(--pico-muted-border-color); padding-bottom: 0.5rem;">
                    <strong>{{ prog.Title }}</strong> <br/>
                    <small>{{ prog.SubTitle|default:"" }}<br/>
                     {{ prog.dt_start|naturalday }} {{ prog.dt_start|date:"g:i A" }}</small>
                </div>
            {% empty %}
                <p>No history found.</p>
            {% endfor %}
            {# doesn't exist yet #}
            {# <footer><a href="#" class="secondary">View All Recordings</a></footer> #}
        </article>
    </aside>

</div>

<div class="grid">
    <article>
        <header><strong>Disk Space</strong></header>
        <progress value="{{ backend.storage.percent_used }}" max="100"></progress>
        <div style="display: flex; justify-content: space-between;">
            <small>{{ backend.storage.free|filesizeformat }} free</small>
            <small><strong>{{ backend.storage.total|filesizeformat }} Total</strong></small>
        </div>
    </article>

    <article>
        <header><strong>Guide Data</strong></header>
        <p>Status: <mark>{{ backend.guide.status }}</mark></p>
        <small>{{ backend.guide.days }} days of data through {{ backend.guide.thru|naturalday }}</small> </article>

    <article>
        <header><strong>System Load</strong></header>
        <h3>{{ backend.load }}</h3>
        <small>1-minute average</small>
    </article>
</div>

<div class="grid">
    <section>
        <h4>Tuners</h4>
        <table>
            <thead>
                <tr>
                    <th>Hostname</th>
                    <th>Input</th>
                    <th>Status</th>
                </tr>
            </thead>
            <tbody>
                {% for tuner in backend.encoders %}
                <tr>
                    <td>{{ tuner.HostName }}</td>
                    <td>{{ tuner.Inputs.0.DisplayName }}</td>
                    <td>
                        {% if tuner.State == 0 %}
                            <span style="color: var(--pico-ins-color);">‚óè Idle</span>
                        {% else %}
                            <span style="color: var(--pico-del-color);">‚óè Recording</span>
                        {% endif %}
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </section>
</div>
{% endblock %}
